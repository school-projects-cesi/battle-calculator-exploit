// imports
import axios from 'axios'

// config
axios.defaults.baseURL = 'https://battle-calculator.azurewebsites.net/api'
axios.defaults.headers['content-type'] = 'application/json'

// main
const authHeader = (token) => ({
	headers: {
		Authorization: `Bearer ${token}`,
	},
})

const main = async () => {
	// récupère le token d'authentification
	const authTokenRequest = await axios.post('/auth/login', {
		username: 'hacker@viacesi.fr',
		password: 'password',
	})
	const authToken = authTokenRequest.data.result.token

	// création d'une game
	const createGameRequest = await axios.post('/games', { level: 1 }, authHeader(authToken))
	const { id: gameId } = createGameRequest.data.result
	let score = createGameRequest.data.result.score

	// boucle pour générer des scores valides
	const iteration = 50
	for (let i = 0; i < iteration; i++) {
		const scoreRequest = await axios.patch(
			`/games/${gameId}/scores/${score.id}`,
			{ result: score.result },
			authHeader(authToken)
		)
		score = scoreRequest.data.result.next
		console.log('+1 Score')
	}

	// fin d'une game
	await axios.patch(`/games/${gameId}/end`, {}, authHeader(authToken))
}

// exports
export default main
